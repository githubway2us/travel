{% extends 'base.html' %}
{% block title %}üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ú‡∏ô: {{ plan.name }}{% endblock %}
{% block content %}
    <h1 class="text-center">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß: {{ plan.name }}</h1>
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5>üéâ {{ plan.name }} ‡πÇ‡∏î‡∏¢ {{ plan.user.username }} üë§</h5>
            <small>üìÖ ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠ {{ plan.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
        </div>
        <div class="card-body">
            <p><strong>üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</strong> {{ plan.province.name }}</p>
            <p><strong>üèïÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong> {{ plan.location or '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</p>
            <p><strong>üóìÔ∏è ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> {{ plan.start_date }} ‡∏ñ‡∏∂‡∏á {{ plan.end_date }}</p>
            <p><strong>üí∏ ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏°:</strong> {{ plan.total_budget|format_number }} ‡∏ö‡∏≤‡∏ó</p>
            {% if current_user %}
                <p><strong>üí∞ ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç PUK ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</strong> {{ puk_coins }} PUK</p>
            {% endif %}
            
            <h6>üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ({{ plan.activities|length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£):</h6>
            {% if plan.activities %}
                <ul class="list-group mb-3">
                    {% for activity in plan.activities %}
                        <li class="list-group-item d-flex align-items-start">
                            <div>
                                {% if activity.time %}
                                    ‚è∞ <strong>{{ activity.time }}</strong>
                                {% else %}
                                    ‚è∞ <span class="text-muted">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤</span>
                                {% endif %}
                                {% if activity.detail %}
                                    : {{ activity.detail }}
                                {% else %}
                                    : <span class="text-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
                                {% endif %}
                                {% if activity.budget %}
                                    <span class="badge bg-success ms-2">üíµ {{ activity.budget|format_number }} ‡∏ö‡∏≤‡∏ó</span>
                                {% endif %}
                                {% if activity.image_path %}
                                    <br><img src="{{ url_for('static', filename='uploads/' + activity.image_path) }}" alt="Activity Image" class="img-fluid mt-2" style="max-width: 200px; border-radius: 5px;">
                                {% endif %}
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">üòî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ</p>
            {% endif %}

            <h6>‚ù§Ô∏è ‡πÑ‡∏•‡∏Å‡πå ({{ plan.likes|length }} ‡∏Ñ‡∏ô):</h6>
            {% if plan.likes %}
                <p>{{ plan.likes|length }} ‡∏Ñ‡∏ô‡∏Å‡∏î‡πÑ‡∏•‡∏Å‡πå</p>
            {% else %}
                <p class="text-muted">üòî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏Å‡∏î‡πÑ‡∏•‡∏Å‡πå</p>
            {% endif %}

            <h6>üí¨ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô:</h6>
            {% if plan.comments %}
                <ul class="list-group mb-3">
                    {% for comment in plan.comments %}
                        <li class="list-group-item">
                            üë§ <strong>{{ comment.user.username }}</strong>: {{ comment.comment }}
                            <small>(üìÖ {{ comment.created_at.strftime('%Y-%m-%d %H:%M') }})</small>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">üòî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</p>
            {% endif %}

            <h6>üí∏ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç PUK:</h6>
            {% if transactions %}
                <ul class="list-group mb-3">
                    {% for transaction in transactions %}
                        <li class="list-group-item">
                            üë§ <strong>{{ transaction.sender.username }}</strong> ‡∏™‡πà‡∏á 
                            <strong>{{ transaction.amount }} PUK</strong> ‡πÉ‡∏´‡πâ 
                            <strong>{{ transaction.receiver.username }}</strong>
                            <small>(üìÖ {{ transaction.created_at.strftime('%Y-%m-%d %H:%M') }})</small>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">üòî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç PUK ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ</p>
            {% endif %}

            {% if session.user_id %}
                <form action="{{ url_for('comment', plan_id=plan.id) }}" method="POST" class="mb-3">
                    <div class="input-group">
                        <input type="text" name="comment" class="form-control" placeholder="‚úçÔ∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô..." required>
                        <button type="submit" class="btn btn-primary">üöÄ ‡∏™‡πà‡∏á</button>
                    </div>
                </form>
                <form action="{{ url_for('like', plan_id=plan.id) }}" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-outline-primary">‚ù§Ô∏è ‡πÑ‡∏•‡∏Å‡πå ({{ plan.likes|length }})</button>
                </form>
                <form action="{{ url_for('send_puk', plan_id=plan.id) }}" method="POST" class="d-inline">
                    <input type="number" name="amount" min="1" max="100" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô PUK" required style="width: 100px;" class="form-control d-inline-block">
                    <button type="submit" class="btn btn-outline-success">üí∞ ‡∏™‡πà‡∏á PUK</button>
                </form>
                {% if plan.user_id == session.user_id %}
                    <div class="mt-3">
                        <a href="{{ url_for('edit_plan', plan_id=plan.id) }}" class="btn btn-warning">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ú‡∏ô</a>
                        <form action="{{ url_for('delete_plan', plan_id=plan.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ? ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÄ‡∏™‡∏µ‡∏¢ 10 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç PUK')">üóëÔ∏è ‡∏•‡∏ö‡πÅ‡∏ú‡∏ô</button>
                        </form>
                    </div>
                {% endif %}
            {% else %}
                <p class="text-muted">üîí ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô, ‡πÑ‡∏•‡∏Å‡πå, ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á PUK</p>
            {% endif %}
        </div>
    </div>
    <a href="{{ url_for('province', province_id=plan.province_id) }}" class="btn btn-secondary">üîô ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ {{ plan.province.name }}</a>
{% endblock %}